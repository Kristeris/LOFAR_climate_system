<div class="chart-container">
  <h2>Climate Sensor Data Visualization</h2>

  <app-date-filter (filterChange)="onFilterChange($event)"></app-date-filter>

  <div class="button-group">
    <button (click)="loadSensors()" [disabled]="loading()">Load All Sensors</button>
    <button (click)="loadLatest10()" [disabled]="loading()">Load Latest 10</button>
    
    @if (!loading() && filteredSensors().length > 0) {
      <div class="download-separator"></div>
      <button (click)="downloadAllCharts('png')" class="download-btn">
        Download All as PNG
      </button>
      <button (click)="downloadAllCharts('jpeg')" class="download-btn">
        Download All as JPEG
      </button>
    }
  </div>

  @if (loading()) {
    <div class="loading">
      <p>Loading sensor data...</p>
    </div>
  }

  @if (error()) {
    <div class="error">
      <p>{{ error() }}</p>
    </div>
  }

  @if (!loading() && sensors().length > 0) {
    <div class="results-info">
      <p>Showing {{ filteredSensors().length }} of {{ sensors().length }} records</p>
    </div>
  }

  @if (!loading() && filteredSensors().length > 0) {
    <div class="charts-grid">
      <div class="chart-item">
        <div class="chart-header">
          <h3>Temperature Over Time</h3>
          <div class="chart-actions">
            <button (click)="downloadChart('temperature', 'png')" class="icon-btn" title="Download as PNG">
              游닌 PNG
            </button>
            <button (click)="downloadChart('temperature', 'jpeg')" class="icon-btn" title="Download as JPEG">
              游닌 JPEG
            </button>
          </div>
        </div>
        <div id="temperatureChart" class="chart"></div>
      </div>
      
      <div class="chart-item">
        <div class="chart-header">
          <h3>Humidity Over Time</h3>
          <div class="chart-actions">
            <button (click)="downloadChart('humidity', 'png')" class="icon-btn" title="Download as PNG">
              游닌 PNG
            </button>
            <button (click)="downloadChart('humidity', 'jpeg')" class="icon-btn" title="Download as JPEG">
              游닌 JPEG
            </button>
          </div>
        </div>
        <div id="humidityChart" class="chart"></div>
      </div>
      
      <div class="chart-item full-width">
        <div class="chart-header">
          <h3>Temperature & Humidity Combined</h3>
          <div class="chart-actions">
            <button (click)="downloadChart('combined', 'png')" class="icon-btn" title="Download as PNG">
              游닌 PNG
            </button>
            <button (click)="downloadChart('combined', 'jpeg')" class="icon-btn" title="Download as JPEG">
              游닌 JPEG
            </button>
          </div>
        </div>
        <div id="combinedChart" class="chart"></div>
      </div>
    </div>
  }

  @if (!loading() && filteredSensors().length === 0 && sensors().length > 0) {
    <div class="no-data">
      <p>No sensor data matches the current filter criteria.</p>
    </div>
  }

  @if (!loading() && sensors().length === 0 && !error()) {
    <div class="no-data">
      <p>No sensor data available. Please load data to view charts.</p>
    </div>
  }
</div>