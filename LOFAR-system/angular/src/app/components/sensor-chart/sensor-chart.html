<div class="chart-container">
  <h2>Climate Sensor Data Visualization</h2>

  <app-date-filter (filterChange)="onFilterChange($event)"></app-date-filter>

  <!-- Bootstrap Grid for Buttons -->
  <div class="row g-2 mb-3">
    <div class="col-12 col-sm-6 col-lg-auto">
      <button (click)="loadSensors()" [disabled]="loading()" class="load-btn">
        Load All Sensors
      </button>
    </div>
    <div class="col-12 col-sm-6 col-lg-auto">
      <button (click)="loadLatest10()" [disabled]="loading()" class="load-btn">
        Load Latest 10
      </button>
    </div>
    
    @if (!loading() && filteredSensors().length > 0) {
      <div class="col-12 col-lg-auto ms-lg-auto">
        <div class="download-separator d-none d-lg-block"></div>
      </div>
      <div class="col-12 col-sm-4 col-lg-auto">
        <button (click)="downloadAllCharts('png')" class="download-btn">
          Download All as PNG
        </button>
      </div>
      <div class="col-12 col-sm-4 col-lg-auto">
        <button (click)="downloadAllCharts('jpeg')" class="download-btn">
          Download All as JPEG
        </button>
      </div>
      <div class="col-12 col-sm-4 col-lg-auto">
        <button (click)="downloadAllCharts('csv')" class="download-btn">
          Download All as CSV
        </button>
      </div>
    }
  </div>

  @if (loading()) {
    <div class="loading">
      <p>Loading sensor data...</p>
    </div>
  }

  @if (error()) {
    <div class="error">
      <p>{{ error() }}</p>
    </div>
  }

  @if (!loading() && sensors().length > 0) {
    <div class="results-info">
      <p>Showing {{ filteredSensors().length }} of {{ sensors().length }} records</p>
    </div>
  }

  @if (!loading() && filteredSensors().length > 0) {
    <!-- Bootstrap Grid for Charts: 1 column on mobile, 2 on large screens -->
    <div class="row g-4">
      <!-- Temperature Chart -->
      <div class="col-12 col-lg-6">
        <div class="chart-item">
          <div class="chart-header">
            <h3>Temperature Over Time</h3>
            <div class="chart-actions">
              <div class="download-dropdown">
                <button (click)="toggleDropdown('temperature'); $event.stopPropagation()" class="icon-download-btn">
                  ðŸ“¥ Download
                </button>
                @if (activeDropdown() === 'temperature') {
                  <div class="dropdown-menu" (click)="$event.stopPropagation()">
                    <button (click)="downloadChart('temperature', 'png')" class="dropdown-item">PNG</button>
                    <button (click)="downloadChart('temperature', 'jpeg')" class="dropdown-item">JPEG</button>
                    <button (click)="downloadChart('temperature', 'csv')" class="dropdown-item">CSV</button>
                    <div class="dropdown-divider"></div>
                    <button (click)="downloadAllFormats('temperature')" class="dropdown-item download-all">Download All</button>
                  </div>
                }
              </div>
            </div>
          </div>
          <div id="temperatureChart" class="chart"></div>
        </div>
      </div>
      
      <!-- Humidity Chart -->
      <div class="col-12 col-lg-6">
        <div class="chart-item">
          <div class="chart-header">
            <h3>Humidity Over Time</h3>
            <div class="chart-actions">
              <div class="download-dropdown">
                <button (click)="toggleDropdown('humidity'); $event.stopPropagation()" class="icon-download-btn">
                  ðŸ“¥ Download
                </button>
                @if (activeDropdown() === 'humidity') {
                  <div class="dropdown-menu" (click)="$event.stopPropagation()">
                    <button (click)="downloadChart('humidity', 'png')" class="dropdown-item">PNG</button>
                    <button (click)="downloadChart('humidity', 'jpeg')" class="dropdown-item">JPEG</button>
                    <button (click)="downloadChart('humidity', 'csv')" class="dropdown-item">CSV</button>
                    <div class="dropdown-divider"></div>
                    <button (click)="downloadAllFormats('humidity')" class="dropdown-item download-all">Download All</button>
                  </div>
                }
              </div>
            </div>
          </div>
          <div id="humidityChart" class="chart"></div>
        </div>
      </div>
      
      <!-- Combined Chart - Full Width -->
      <div class="col-12">
        <div class="chart-item full-width">
          <div class="chart-header">
            <h3>Temperature & Humidity Combined</h3>
            <div class="chart-actions">
              <div class="download-dropdown">
                <button (click)="toggleDropdown('combined'); $event.stopPropagation()" class="icon-download-btn">
                  ðŸ“¥ Download
                </button>
                @if (activeDropdown() === 'combined') {
                  <div class="dropdown-menu" (click)="$event.stopPropagation()">
                    <button (click)="downloadChart('combined', 'png')" class="dropdown-item">PNG</button>
                    <button (click)="downloadChart('combined', 'jpeg')" class="dropdown-item">JPEG</button>
                    <button (click)="downloadChart('combined', 'csv')" class="dropdown-item">CSV</button>
                    <div class="dropdown-divider"></div>
                    <button (click)="downloadAllFormats('combined')" class="dropdown-item download-all">Download All</button>
                  </div>
                }
              </div>
            </div>
          </div>
          <div id="combinedChart" class="chart"></div>
        </div>
      </div>
    </div>
  }

  @if (!loading() && filteredSensors().length === 0 && sensors().length > 0) {
    <div class="no-data">
      <p>No sensor data matches the current filter criteria.</p>
    </div>
  }

  @if (!loading() && sensors().length === 0 && !error()) {
    <div class="no-data">
      <p>No sensor data available. Please load data to view charts.</p>
    </div>
  }
</div>