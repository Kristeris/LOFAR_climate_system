<div class="sensor-container">
    <h2>Climate Sensor Data</h2>

    <!-- WebSocket Status Indicator -->
    <div class="ws-status-banner" [class.connected]="wsConnected()" [class.disconnected]="!wsConnected()">
        <div class="status-content">
            <span class="status-dot"></span>
            <span class="status-text">
                {{ wsConnected() ? 'üî¥ LIVE - Auto-updating from WebSocket' : '‚ö†Ô∏è Disconnected - Manual refresh only' }}
            </span>
            @if (wsConnected() && lastUpdateTime() !== 'Never') {
                <span class="last-update">Last update: {{ lastUpdateTime() }}</span>
            }
        </div>
    </div>

    <app-date-filter (filterChange)="onFilterChange($event)"></app-date-filter>

    <div class="button-group">
        <button (click)="loadSensors()">Load All Sensors</button>
        <button (click)="loadLatest10()">Load Latest 10</button>
    </div>

    @if (loading()) {
    <p>Loading sensor data...</p>
    }

    @if (error()) {
    <p class="error">{{ error() }}</p>
    }

    @if (!loading() && filteredSensors().length > 0) {
    <div class="results-info">
        <p>
            Showing {{ filteredSensors().length }} of {{ sensors().length }} records
            @if (filteredSensors().length !== sensors().length) {
                <span class="filter-note">({{ sensors().length - filteredSensors().length }} hidden by filters)</span>
            }
        </p>
    </div>
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Temperature (¬∞C)</th>
            <th>Humidity (%)</th>
            <th>Date & Time</th>
        </tr>
        </thead>
        <tbody>
        @for (sensor of filteredSensors(); track sensor.sensorId; let i = $index) {
            <tr [class.new-row]="isNewRow(sensor)">
            <td>{{ sensor.sensorId }}</td>
            <td>{{ sensor.temperature }}</td>
            <td>{{ sensor.humidity }}</td>
            <td>{{ sensor.sensorDateTime }}</td>
            </tr>
        }
        </tbody>
    </table>
    }

    @if (!loading() && filteredSensors().length === 0 && sensors().length > 0) {
    <p class="no-results">
        No sensor data matches the current filter criteria.
        <br>
        <small>({{ sensors().length }} total records available - try adjusting or clearing filters)</small>
    </p>
    }

    @if (!loading() && sensors().length === 0 && !error()) {
    <p>No sensor data available.</p>
    }
</div>